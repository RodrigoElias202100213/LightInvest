@model LightInvest.Models.DadosInstalacaoViewModel

@{
    ViewData["Title"] = "Solicitação de Instalação";
}

<h2 class="text-center my-4">Solicitação de Instalação</h2>

@if (ViewBag.Resultado != null)
{
    <div class="alert alert-danger">@ViewBag.Resultado</div>
}

<form asp-action="Create" method="post" class="container card p-4 shadow">
    <div class="mb-3">
        <label class="form-label">Cidade</label>
        <select asp-for="CidadeId" class="form-select" required>
            <option value="">Selecione a cidade</option>
            @foreach (var cidade in Model.Cidades)
            {
                <option value="@cidade.Id">@cidade.Nome</option>
            }
        </select>
        <span class="text-danger" asp-validation-for="CidadeId"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Modelo do Painel Solar</label>
        <select id="modeloPainelSelect" asp-for="ModeloPainelId" class="form-select" required>
            <option value="">Selecione o modelo</option>
            @foreach (var modelo in Model.ModelosDePaineis)
            {
                <option value="@modelo.Id">@modelo.ModeloNome - R$ @modelo.Preco</option>
            }
        </select>
        <span class="text-danger" asp-validation-for="ModeloPainelId"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Potência do Painel</label>
        <select id="consumoPainelSelect" asp-for="PotenciaId" class="form-select" required>
            <option value="">Selecione a potência</option>
            @if (Model.Potencias != null)
            {
                foreach (var potencia in Model.Potencias)
                {
                    <option value="@potencia.Id">@potencia.Potencia W</option>
                }
            }
        </select>
        <span class="text-danger" asp-validation-for="PotenciaId"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Número de Painéis</label>
        <input asp-for="NumeroPaineis" class="form-control" type="number" min="1" max="1000" required />
        <span class="text-danger" asp-validation-for="NumeroPaineis"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Inclinação (graus)</label>
        <input asp-for="Inclinacao" class="form-control" type="number" step="0.1" min="0" max="90" required />
        <span class="text-danger" asp-validation-for="Inclinacao"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">Dificuldade de Instalação</label>
        <select asp-for="Dificuldade" class="form-select" required>
            <option value="Facil">Fácil</option>
            <option value="Media">Média</option>
            <option value="Dificil">Difícil</option>
        </select>
        <span class="text-danger" asp-validation-for="Dificuldade"></span>
    </div>

    <button type="submit" class="btn btn-primary w-100">Calcular Preço</button>
</form>



@section Scripts {
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
			$(document).ready(function () {
				$("#modeloPainelSelect").change(function () {
					var modeloPainelId = $(this).val();

					if (modeloPainelId) {
						$.ajax({
							url: "/DadosInstalacao/GetConsumosPainel",
							type: "GET",
							data: { modeloPainelId: modeloPainelId },
							success: function (data) {
								var consumoSelect = $("#consumoPainelSelect");
								consumoSelect.empty();
								consumoSelect.append('<option value="">Selecione um consumo</option>');
								$.each(data, function (index, item) {
									consumoSelect.append('<option value="' + item.id + '">' + item.potencia + ' kWh</option>');
								});
							},
							error: function () {
								$("#consumoPainelSelect").empty();
								$("#consumoPainelSelect").append('<option value="">Erro ao carregar consumos</option>');
							}
						});
					} else {
						$("#consumoPainelSelect").empty();
						$("#consumoPainelSelect").append('<option value="">Selecione um consumo</option>');
					}
				});
			});
		</script>
}

